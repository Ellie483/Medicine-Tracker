{% extends "base.html" %}

{% block title %}Add Medicine - Medicine Tracker{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="fas fa-plus me-2"></i>Add New Medicine</h4>
            </div>
            {% if error %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ error }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            {% if flash_message %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ flash_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            <div class="card-body">
                <form method="post" action="/seller/add-medicine" enctype="multipart/form-data">

                    <!-- Medicine Image Upload -->
                    <div class="mb-3">
                        <label for="medicine_image" class="form-label">Medicine Image <b class="text-danger">*</b></label>
                        <input type="file" class="form-control" id="medicine_image" name="medicine_image" 
                            accept="image/*" capture="environment" required>
                        
                        <!-- Preview -->
                        <div id="imagePreview" class="mt-3 text-center d-none">
                            <img id="previewImg" class="img-fluid rounded shadow-sm border" style="max-height: 200px; object-fit: contain;" alt="Preview">
                        </div>
                    </div>

                    <!-- Medicine Name -->
                    <div class="mb-3">
                        <label for="name" class="form-label">Medicine Name <b class="text-danger">*</b></label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        <label for="description" class="form-label">Description <b class="text-danger">*</b></label>
                        <textarea class="form-control" id="description" name="description" rows="3" required
                                placeholder="eg. Made in US. Effective in curing fever..."></textarea>
                    </div>
                    
                    <!-- Stock -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="stock" class="form-label">Stock Quantity <b class="text-danger">*</b></label>
                                <input type="number" class="form-control" id="stock" name="stock" min="0" required>
                            </div>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="buying_price" class="form-label">Buying Price (Ks) <b class="text-danger">*</b></label>
                                <input type="number" class="form-control" id="buying_price" name="buying_price" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="selling_price" class="form-label">Selling Price (Ks) <b class="text-danger">*</b></label>
                                <input type="number" class="form-control" id="selling_price" name="selling_price" step="0.01" min="0" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expiration Date -->
                    <div class="mb-3">
                        <label for="expiration_date" class="form-label">Expiration Date <b class="text-danger">*</b></label>
                        <input type="date" class="form-control" id="expiration_date" name="expiration_date" required>
                    </div>
                    
                    <!-- Buttons -->
                    <div class="d-flex gap-2 justify-content-center my-4">
                        <a href="/seller/inventory" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-2"></i>Add Medicine
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JS for Image Preview -->
<script>
    document.getElementById('medicine_image').addEventListener('change', function(event) {
        const file = event.target.files[0];
        const previewContainer = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewContainer.classList.remove('d-none');
            }
            reader.readAsDataURL(file);
        } else {
            previewContainer.classList.add('d-none');
            previewImg.src = "";
        }
    });
</script>
{% endblock %}
